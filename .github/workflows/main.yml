name: Notepads CI/CD Pipeline

on: 
  [ push, pull_request, workflow_dispatch ]

jobs:
  ci:
    runs-on: windows-latest
    outputs:
      new_version: "${{ steps.tag_generator.outputs.new_version }}.0"
      new_version_tag: "v${{ steps.tag_generator.outputs.new_version }}.0"
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 50
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Bump GitHub tag
        id: tag_generator
        uses: soumyamahunt/github-tag-action@test-other-ver-support
        with: 
          github_token: ${{ secrets.GITHUB_TOKEN }}
          latest_ver: '1.2.3'
          default_bump: false
          dry_run: true

      - name: Update tags
        id: update_tag
        shell: pwsh
        run: |
          echo "New version is $env:NEW_VERSION"
          echo "New tag is $env:NEW_VERSION_TAG"
        env:
          NEW_VERSION: "${{ steps.tag_generator.outputs.new_version }}.0"
          NEW_VERSION_TAG: "v${{ steps.tag_generator.outputs.new_version }}.0"

  cd:
    needs: ci
    runs-on: windows-latest
    env:
      NEW_ASSEMBLY_VERSION: ${{ needs.ci.outputs.new_version }}
      NEW_TAG: ${{ needs.ci.outputs.new_version_tag }}
    steps:
      - name: Check output
        id: check_output
        run: |
          echo "New version is $env:NEW_ASSEMBLY_VERSION"
          echo "New tag is $env:NEW_TAG"

# Built with ‚ù§ by [Pipeline Foundation](https://pipeline.foundation)
